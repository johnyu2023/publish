import{_ as i,c as a,o as t,a1 as e}from"./chunks/framework.6sy4tsQT.js";const c=JSON.parse('{"title":"Pytest + TestClient é‡æ„","description":"ä»‹ç»äº†ä»SQLiteè¿ç§»åˆ°PostgreSQLåï¼Œä½¿ç”¨Pytest+TestClienté‡æ„åç«¯é¡¹ç›®æµ‹è¯•ç”¨ä¾‹çš„æ–¹æ¡ˆã€‚æ ¸å¿ƒæ˜¯é€šè¿‡fixtureå®ç°æµ‹è¯•æ•°æ®åº“éš”ç¦»ï¼Œç¡®ä¿æµ‹è¯•è¿æ¥æ­£ç¡®çš„æ•°æ®åº“ã€‚","frontmatter":{"title":"Pytest + TestClient é‡æ„","description":"ä»‹ç»äº†ä»SQLiteè¿ç§»åˆ°PostgreSQLåï¼Œä½¿ç”¨Pytest+TestClienté‡æ„åç«¯é¡¹ç›®æµ‹è¯•ç”¨ä¾‹çš„æ–¹æ¡ˆã€‚æ ¸å¿ƒæ˜¯é€šè¿‡fixtureå®ç°æµ‹è¯•æ•°æ®åº“éš”ç¦»ï¼Œç¡®ä¿æµ‹è¯•è¿æ¥æ­£ç¡®çš„æ•°æ®åº“ã€‚","date":"2026-01-01T00:00:00.000Z","tags":["pytest","testclient"]},"headers":[],"relativePath":"fullstack/pytest-testclient.md","filePath":"fullstack/pytest-testclient.md"}'),n={name:"fullstack/pytest-testclient.md"};function l(p,s,h,k,r,d){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="èƒŒæ™¯æè¿°" tabindex="-1">èƒŒæ™¯æè¿° <a class="header-anchor" href="#èƒŒæ™¯æè¿°" aria-label="Permalink to &quot;èƒŒæ™¯æè¿°&quot;">â€‹</a></h2><ul><li>ä¸€ä¸ªåç«¯é¡¹ç›®ï¼Œä¸»è¦æ˜¯å¯¹æ•°æ®åº“ä¸­8å¼ è¡¨çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚ä¹‹å‰ä½¿ç”¨çš„æ˜¯ sqlite ï¼Œç°åœ¨æ•°æ®å·²ç»è¿ç§»åˆ°è¿œç¨‹çš„ postgresql ã€‚åç«¯åšäº†ä¸€äº›ä¿®æ”¹ï¼Œå¯åŠ¨åï¼Œéƒ¨åˆ†åŠŸèƒ½æ­£å¸¸ï¼Œéƒ¨åˆ†åŠŸèƒ½æœ‰é—®é¢˜ã€‚</li><li>é¡¹ç›®ä¹‹å‰æ˜¯æœ‰ä¸€äº›æµ‹è¯•ç”¨ä¾‹çš„ï¼Œä½¿ç”¨äº† Pytest + TestClient æŠ€æœ¯æ ˆã€‚ä¸è¿‡å®ƒä»¬ä¼¼ä¹éƒ¨åˆ†è¿˜æ˜¯é¡½å›ºåœ°è¿æ¥åˆ°äº†ä¹‹å‰çš„ sqlite ä¸­å»äº†ï¼Œè¿™è®©æˆ‘æ€€ç–‘è¿™äº›æµ‹è¯•ç”¨ä¾‹æ•´ä½“ä¸Šçš„å¯é æ€§ã€‚</li></ul><h2 id="é‡æ„æ€è·¯" tabindex="-1">é‡æ„æ€è·¯ <a class="header-anchor" href="#é‡æ„æ€è·¯" aria-label="Permalink to &quot;é‡æ„æ€è·¯&quot;">â€‹</a></h2><blockquote><p>ä¸éœ€è¦å½»åº•é‡å†™æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œä½†éœ€è¦ç³»ç»Ÿæ€§åœ°é‡æ„å’Œä¿®å¤ï¼Œä»¥ç¡®ä¿æµ‹è¯•çš„å¯é æ€§ã€å¯ç»´æŠ¤æ€§å’Œç¯å¢ƒéš”ç¦»æ€§ã€‚</p></blockquote><h3 id="_1-é¦–è¦ä»»åŠ¡-éš”ç¦»æµ‹è¯•æ•°æ®åº“-æœç»-è¿é”™åº“" tabindex="-1">1. é¦–è¦ä»»åŠ¡ï¼šéš”ç¦»æµ‹è¯•æ•°æ®åº“ï¼Œæœç»â€œè¿é”™åº“â€ <a class="header-anchor" href="#_1-é¦–è¦ä»»åŠ¡-éš”ç¦»æµ‹è¯•æ•°æ®åº“-æœç»-è¿é”™åº“" aria-label="Permalink to &quot;1. é¦–è¦ä»»åŠ¡ï¼šéš”ç¦»æµ‹è¯•æ•°æ®åº“ï¼Œæœç»â€œè¿é”™åº“â€&quot;">â€‹</a></h3><ul><li><strong>ä½¿ç”¨æµ‹è¯•ä¸“ç”¨çš„ PostgreSQL æ•°æ®åº“</strong>ï¼ˆå¦‚ <code>yourapp_test</code>ï¼‰ï¼Œè€Œéå¼€å‘æˆ–ç”Ÿäº§åº“ã€‚</li><li>åœ¨ <code>pytest</code> ä¸­é€šè¿‡ <strong>fixture + ç¯å¢ƒå˜é‡</strong> åŠ¨æ€æ³¨å…¥æ•°æ®åº“ URL</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # conftest.py</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pytest</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sqlalchemy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> create_engine</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sqlalchemy.orm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sessionmaker</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> your_app.db </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Base</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   TEST_DB_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os.getenv(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TEST_DATABASE_URL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;postgresql://user:pass@localhost/yourapp_test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   @pytest.fixture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">scope</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;session&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test_engine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       engine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> create_engine(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TEST_DB_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       Base.metadata.create_all(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">bind</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">engine)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºæµ‹è¯•è¡¨ç»“æ„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       yield</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> engine</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       Base.metadata.drop_all(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">bind</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">engine)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¸…ç†</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   @pytest.fixture</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> db_session</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(test_engine):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       Session </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sessionmaker(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">bind</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">test_engine)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       session </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Session()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           yield</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> session</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       finally</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           session.rollback()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           session.close()</span></span></code></pre></div><ul><li><strong>ç¡®ä¿æ‰€æœ‰æµ‹è¯•æ–‡ä»¶é€šè¿‡ fixture æ³¨å…¥ sessionï¼Œè€Œéç›´æ¥ import å…¨å±€ session</strong>ã€‚å¦åˆ™å®¹æ˜“æ±¡æŸ“ä¸»åº”ç”¨çš„æ•°æ®åº“è¿æ¥é…ç½®ã€‚</li></ul><hr><h3 id="_2-é‡æ„ç­–ç•¥-ä¿ç•™é€»è¾‘-æ›¿æ¢ä¾èµ–" tabindex="-1">2. é‡æ„ç­–ç•¥ï¼šä¿ç•™é€»è¾‘ï¼Œæ›¿æ¢ä¾èµ– <a class="header-anchor" href="#_2-é‡æ„ç­–ç•¥-ä¿ç•™é€»è¾‘-æ›¿æ¢ä¾èµ–" aria-label="Permalink to &quot;2. é‡æ„ç­–ç•¥ï¼šä¿ç•™é€»è¾‘ï¼Œæ›¿æ¢ä¾èµ–&quot;">â€‹</a></h3><blockquote><p>åŸæµ‹è¯•ç”¨ä¾‹ç»“æ„æ˜¯åˆç†çš„ï¼ˆåˆ†å±‚ï¼šAPI â†’ CRUD â†’ Modelï¼‰ï¼Œ<strong>é€»è¾‘å¯å¤ç”¨ï¼Œåªéœ€ä¿®å¤æ•°æ®åº“è¿æ¥å’Œäº‹åŠ¡ç®¡ç†</strong>ã€‚</p></blockquote><ul><li><strong>ä¿ç•™</strong>ï¼šæµ‹è¯•åœºæ™¯ã€æ–­è¨€é€»è¾‘ã€è¾¹ç•Œæ¡ä»¶ï¼ˆå¦‚åˆ†é¡µã€æ—¥æœŸç­›é€‰ï¼‰ã€‚</li><li><strong>æ›¿æ¢/ä¿®å¤</strong>ï¼š <ul><li>æ‰€æœ‰æ•°æ®åº“è¿æ¥åˆå§‹åŒ–æ–¹å¼ï¼›</li><li>äº‹åŠ¡å›æ»šæœºåˆ¶ï¼ˆç¡®ä¿æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹åè‡ªåŠ¨æ¸…ç†æ•°æ®ï¼‰ï¼›</li><li>æ¨¡å‹åˆ›å»ºæ–¹å¼ï¼ˆç¡®ä¿ä½¿ç”¨æµ‹è¯• session è€Œéå…¨å±€ sessionï¼‰ã€‚</li></ul></li></ul><hr><h3 id="_3-å…³é”®æ”¹è¿›ç‚¹" tabindex="-1">3. å…³é”®æ”¹è¿›ç‚¹ <a class="header-anchor" href="#_3-å…³é”®æ”¹è¿›ç‚¹" aria-label="Permalink to &quot;3. å…³é”®æ”¹è¿›ç‚¹&quot;">â€‹</a></h3><h4 id="_1-ç»Ÿä¸€æ•°æ®åº“è¿æ¥é…ç½®" tabindex="-1">1. <strong>ç»Ÿä¸€æ•°æ®åº“è¿æ¥é…ç½®</strong> <a class="header-anchor" href="#_1-ç»Ÿä¸€æ•°æ®åº“è¿æ¥é…ç½®" aria-label="Permalink to &quot;1. **ç»Ÿä¸€æ•°æ®åº“è¿æ¥é…ç½®**&quot;">â€‹</a></h4><ul><li>ä¸»åº”ç”¨å’Œæµ‹è¯•åº”é€šè¿‡ <strong>åŒä¸€å¥—é…ç½®æœºåˆ¶</strong>ï¼ˆå¦‚ Pydantic Settings æˆ–ç¯å¢ƒå˜é‡ï¼‰è¯»å– <code>DATABASE_URL</code>ã€‚</li><li>æµ‹è¯•æ—¶é€šè¿‡ <code>pytest --override-ini=...</code> æˆ– <code>env TEST_DATABASE_URL=... pytest</code> æŒ‡å®šæµ‹è¯•åº“ã€‚</li></ul><h4 id="_2-ä½¿ç”¨äº‹åŠ¡å›æ»šå®ç°æµ‹è¯•éš”ç¦»" tabindex="-1">2. <strong>ä½¿ç”¨äº‹åŠ¡å›æ»šå®ç°æµ‹è¯•éš”ç¦»</strong> <a class="header-anchor" href="#_2-ä½¿ç”¨äº‹åŠ¡å›æ»šå®ç°æµ‹è¯•éš”ç¦»" aria-label="Permalink to &quot;2. **ä½¿ç”¨äº‹åŠ¡å›æ»šå®ç°æµ‹è¯•éš”ç¦»**&quot;">â€‹</a></h4><p>å¯¹æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œåœ¨ setup æ—¶å¼€å¯äº‹åŠ¡ï¼Œteardown æ—¶ rollbackï¼ˆè€Œé commitï¼‰ï¼Œé¿å…æ•°æ®æ®‹ç•™ã€‚ç¤ºä¾‹ï¼š</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@pytest.fixture</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> clean_db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(db_session):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    transaction </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db_session.begin()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    yield</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db_session</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    transaction.rollback()</span></span></code></pre></div><h4 id="_3-åˆ é™¤å†—ä½™æµ‹è¯•æ–‡ä»¶" tabindex="-1">3. <strong>åˆ é™¤å†—ä½™æµ‹è¯•æ–‡ä»¶</strong> <a class="header-anchor" href="#_3-åˆ é™¤å†—ä½™æµ‹è¯•æ–‡ä»¶" aria-label="Permalink to &quot;3. **åˆ é™¤å†—ä½™æµ‹è¯•æ–‡ä»¶**&quot;">â€‹</a></h4><p>åŸæœ‰ 9 ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œå­˜åœ¨æ˜æ˜¾é‡å ï¼š</p><ul><li><code>test_db_connection.py</code>ã€<code>test_db_simple.py</code>ã€<code>test_db_operations.py</code> åŠŸèƒ½é«˜åº¦é‡å¤ â†’ <strong>åˆå¹¶ä¸ºä¸€ä¸ª <code>test_database.py</code></strong>ã€‚</li><li><code>test_login_logout.py</code> å’Œ <code>test_api_with_auth.py</code> ä¹Ÿæœ‰é‡å  â†’ <strong>ä¿ç•™åè€…ï¼Œå‰è€…å¯åˆ </strong>ã€‚</li><li><code>test_weight_records.py</code> åŠŸèƒ½å·²è¢« <code>test_crud.py</code> å’Œ <code>test_api.py</code> è¦†ç›– â†’ <strong>å¯åˆ é™¤æˆ–ä¿ç•™ä½œä¸ºä¸“é¡¹å‹åŠ›æµ‹è¯•</strong>ã€‚</li></ul><blockquote><p>ğŸ§¹ ç²¾ç®€ååº”ä¿ç•™ 4 ç±»æµ‹è¯•ï¼š</p><ol><li><code>test_models.py</code>ï¼ˆæ¨¡å‹ç»“æ„ï¼‰</li><li><code>test_crud.py</code>ï¼ˆæ•°æ®åº“æ“ä½œï¼‰</li><li><code>test_api.py</code>ï¼ˆå«è®¤è¯çš„ç«¯åˆ°ç«¯ API æµ‹è¯•ï¼‰</li><li><code>test_database.py</code>ï¼ˆè¿æ¥ä¸åŸºç¡€è¯»å†™ï¼‰</li></ol></blockquote><h4 id="_4-å¢åŠ -postgresql-ç‰¹æ€§å…¼å®¹æ€§æµ‹è¯•" tabindex="-1">4. <strong>å¢åŠ  PostgreSQL ç‰¹æ€§å…¼å®¹æ€§æµ‹è¯•</strong> <a class="header-anchor" href="#_4-å¢åŠ -postgresql-ç‰¹æ€§å…¼å®¹æ€§æµ‹è¯•" aria-label="Permalink to &quot;4. **å¢åŠ  PostgreSQL ç‰¹æ€§å…¼å®¹æ€§æµ‹è¯•**&quot;">â€‹</a></h4><p>SQLite ä¸ PostgreSQL åœ¨ä»¥ä¸‹æ–¹é¢æœ‰å·®å¼‚ï¼Œéœ€ä¸“é¡¹éªŒè¯ï¼š</p><ul><li>å¤§å°å†™æ•æ„Ÿï¼ˆPostgreSQL è¡¨å/åˆ—åé»˜è®¤å°å†™ï¼‰ï¼›</li><li>æ•°æ®ç±»å‹ï¼ˆå¦‚ <code>DATETIME</code> vs <code>TIMESTAMP</code>ï¼‰ï¼›</li><li>è‡ªå¢ ID è¡Œä¸ºï¼›</li><li>å­—ç¬¦ä¸²æ¯”è¾ƒï¼ˆ<code>ILIKE</code> vs <code>LIKE</code>ï¼‰ï¼›</li><li>åˆ†é¡µè¯­æ³•ï¼ˆè™½ç„¶ç”¨ ORM å¯èƒ½å±è”½äº†ï¼Œä½†éœ€ç¡®è®¤ï¼‰ã€‚</li></ul><hr><h3 id="_4-éªŒè¯è¿ç§»æ˜¯å¦æˆåŠŸ-å…³é”®æ£€æŸ¥æ¸…å•" tabindex="-1">4. éªŒè¯è¿ç§»æ˜¯å¦æˆåŠŸï¼šå…³é”®æ£€æŸ¥æ¸…å• <a class="header-anchor" href="#_4-éªŒè¯è¿ç§»æ˜¯å¦æˆåŠŸ-å…³é”®æ£€æŸ¥æ¸…å•" aria-label="Permalink to &quot;4. éªŒè¯è¿ç§»æ˜¯å¦æˆåŠŸï¼šå…³é”®æ£€æŸ¥æ¸…å•&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>é¡¹ç›®</th><th>æ£€æŸ¥æ–¹å¼</th></tr></thead><tbody><tr><td>æ‰€æœ‰æµ‹è¯•è¿æ¥çš„æ˜¯ PostgreSQL</td><td>åœ¨æµ‹è¯•ä¸­æ‰“å° <code>engine.url</code>ï¼Œç¡®è®¤æ—  <code>sqlite</code></td></tr><tr><td>æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç‹¬ç«‹ã€æ— çŠ¶æ€</td><td>è¿è¡Œå•ä¸ªæµ‹è¯•ã€å¤šä¸ªæµ‹è¯•ã€ä¹±åºè¿è¡Œï¼Œç»“æœä¸€è‡´</td></tr><tr><td>æ•°æ®åœ¨æµ‹è¯•åè‡ªåŠ¨æ¸…ç†</td><td>æµ‹è¯•ç»“æŸåæŸ¥è¡¨åº”ä¸ºç©ºæˆ–åˆå§‹çŠ¶æ€</td></tr><tr><td>åˆ†é¡µ/ç­›é€‰/æ’åºç»“æœæ­£ç¡®</td><td>å¯¹æ¯” SQLite ä¸ PostgreSQL è¿”å›ç»“æœæ˜¯å¦ä¸€è‡´</td></tr><tr><td>é”™è¯¯å¤„ç†æ­£å¸¸ï¼ˆå¦‚å”¯ä¸€çº¦æŸã€éç©ºçº¦æŸï¼‰</td><td>PostgreSQL çº¦æŸæ›´ä¸¥æ ¼ï¼Œéœ€éªŒè¯å¼‚å¸¸è¢«æ•è·</td></tr></tbody></table><hr><h3 id="_5-è¡ŒåŠ¨å»ºè®®-åˆ†æ­¥" tabindex="-1">5. è¡ŒåŠ¨å»ºè®®ï¼ˆåˆ†æ­¥ï¼‰ <a class="header-anchor" href="#_5-è¡ŒåŠ¨å»ºè®®-åˆ†æ­¥" aria-label="Permalink to &quot;5. è¡ŒåŠ¨å»ºè®®ï¼ˆåˆ†æ­¥ï¼‰&quot;">â€‹</a></h3><ol><li><strong>ç«‹å³</strong>ï¼šå»ºç«‹ç‹¬ç«‹çš„ <code>yourapp_test</code> PostgreSQL æ•°æ®åº“ã€‚</li><li><strong>ä¿®æ”¹</strong>ï¼šé…ç½®ç³»ç»Ÿï¼Œæ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡åˆ‡æ¢ DB URLã€‚</li><li><strong>é‡æ„</strong> <code>conftest.py</code>ï¼Œå¼•å…¥ fixture ç®¡ç†æµ‹è¯• DB ç”Ÿå‘½å‘¨æœŸã€‚</li><li><strong>é€ä¸ªä¿®å¤</strong>æµ‹è¯•æ–‡ä»¶ï¼Œæ›¿æ¢ç¡¬ç¼–ç è¿æ¥ï¼Œä½¿ç”¨ fixture æ³¨å…¥ sessionã€‚</li><li><strong>åˆ é™¤å†—ä½™æµ‹è¯•æ–‡ä»¶</strong>ï¼Œåˆå¹¶é‡å¤é€»è¾‘ã€‚</li><li><strong>è¿è¡Œå…¨é‡æµ‹è¯•</strong>ï¼Œç¡®è®¤ï¼š <ul><li>æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼›</li><li>æ— è¿æ¥ SQLite çš„æ—¥å¿—ï¼›</li><li>æµ‹è¯•æ•°æ®åº“åœ¨è¿è¡Œåä¸ºç©ºã€‚</li></ul></li></ol><h2 id="å‡†å¤‡ç¯å¢ƒ-æ•°æ®åº“" tabindex="-1">å‡†å¤‡ç¯å¢ƒ - æ•°æ®åº“ <a class="header-anchor" href="#å‡†å¤‡ç¯å¢ƒ-æ•°æ®åº“" aria-label="Permalink to &quot;å‡†å¤‡ç¯å¢ƒ - æ•°æ®åº“&quot;">â€‹</a></h2><blockquote><p>pytest è¦æ±‚è¿æ¥åˆ°ä¸€ä¸ªæ²¡æœ‰æ•°æ®çš„ç©ºæ•°æ®åº“ä¸­</p></blockquote><h3 id="ç”¨-putty-è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨" tabindex="-1">ç”¨ PuTTY è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ <a class="header-anchor" href="#ç”¨-putty-è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨" aria-label="Permalink to &quot;ç”¨ PuTTY è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨&quot;">â€‹</a></h3><ul><li>ç”¨ deploy è¿™ä¸ªç”¨æˆ·ç™»å½•åˆ°è¿œç¨‹æœåŠ¡å™¨</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºå·¥ä½œç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/pg_migration</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿›å…¥å·¥ä½œç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/pg_migration</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ‰§è¡Œ pg_dump å‘½ä»¤ï¼Œå°†å¼€å‘æ•°æ®åº“çš„ schema å¯¼å‡ºåˆ° create_schema.sql æ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pg_dump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -U</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kpfit_dev</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kpfit_dev_db</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --schema-only</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-owner</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-privileges</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create_schema.sql</span></span></code></pre></div><h3 id="é€šè¿‡-filezilla-ä¸‹è½½-create-schema-sql-æ–‡ä»¶" tabindex="-1">é€šè¿‡ FileZilla ä¸‹è½½ create_schema.sql æ–‡ä»¶ <a class="header-anchor" href="#é€šè¿‡-filezilla-ä¸‹è½½-create-schema-sql-æ–‡ä»¶" aria-label="Permalink to &quot;é€šè¿‡ FileZilla ä¸‹è½½ create_schema.sql æ–‡ä»¶&quot;">â€‹</a></h3><ul><li>ç”¨ deploy è¿™ä¸ªç”¨æˆ·ï¼Œé€šè¿‡ FileZilla è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚æ³¨æ„ï¼šç”¨æˆ·åå’Œ PuTTY ä¸­é…ç½®çš„ä¸€è‡´ã€‚</li><li>ä»è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ <code>~/pg_migration</code> ç›®å½•ä¸‹è½½ <code>create_schema.sql</code> æ–‡ä»¶åˆ°æœ¬åœ°ã€‚</li></ul><h3 id="dbeaver-ä¸­æ‰§è¡Œ-create-schema-sql-æ–‡ä»¶" tabindex="-1">DBeaver ä¸­æ‰§è¡Œ create_schema.sql æ–‡ä»¶ <a class="header-anchor" href="#dbeaver-ä¸­æ‰§è¡Œ-create-schema-sql-æ–‡ä»¶" aria-label="Permalink to &quot;DBeaver ä¸­æ‰§è¡Œ create_schema.sql æ–‡ä»¶&quot;">â€‹</a></h3><ul><li><p>æ³¨æ„ï¼šDBeaver ä½œä¸ºä¸€ä¸ªæ ‡å‡†çš„ SQL å®¢æˆ·ç«¯ï¼Œä¸è®¤è¯† \\ å¼€å¤´çš„å‘½ä»¤ï¼Œæ‰€ä»¥ä¼šæŠ¥è¯­æ³•é”™è¯¯ã€‚æ‰€ä»¥åº”å…ˆæŸ¥æ‰¾å¹¶åˆ é™¤æ‰€æœ‰ä»¥ \\ å¼€å¤´çš„è¡Œï¼š</p><ul><li>åˆ é™¤ç¬¬ä¸€è¡Œçš„ \\restrict ...ã€‚</li><li>åˆ é™¤æœ€åä¸€è¡Œçš„ \\unrestrict ...ã€‚</li></ul></li><li><p>ç”¨ DBeaver è¿æ¥åˆ°æµ‹è¯•æ•°æ®åº“ï¼ˆ<code>kpfit_test_db</code>ï¼‰ã€‚</p></li><li><p>æ‰“å¼€ <code>create_schema.sql</code> æ–‡ä»¶ï¼Œç‚¹å‡»å³é”®é€‰æ‹© <code>Run as SQL Script</code>ã€‚</p></li><li><p>ç¡®è®¤æ‰§è¡Œåï¼Œæµ‹è¯•æ•°æ®åº“åº”åŒ…å«ä¸å¼€å‘æ•°æ®åº“ç›¸åŒçš„ schemaã€‚</p></li></ul><h2 id="æµ‹è¯•ç”¨ä¾‹é‡æ„" tabindex="-1">æµ‹è¯•ç”¨ä¾‹é‡æ„ <a class="header-anchor" href="#æµ‹è¯•ç”¨ä¾‹é‡æ„" aria-label="Permalink to &quot;æµ‹è¯•ç”¨ä¾‹é‡æ„&quot;">â€‹</a></h2><h3 id="æ–‡ä»¶ç›®å½•ç»“æ„" tabindex="-1">æ–‡ä»¶ç›®å½•ç»“æ„ <a class="header-anchor" href="#æ–‡ä»¶ç›®å½•ç»“æ„" aria-label="Permalink to &quot;æ–‡ä»¶ç›®å½•ç»“æ„&quot;">â€‹</a></h3><div class="language-plaintext vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plaintext</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>    1 keepfit\\</span></span>
<span class="line"><span>    2 â””â”€â”€ server\\</span></span>
<span class="line"><span>    3     â””â”€â”€ tests\\                 # pytest æµ‹è¯•ç”¨ä¾‹ä¸»ç›®å½•</span></span>
<span class="line"><span>    4         â”œâ”€â”€ __init__.py       # Python åŒ…æ ‡è¯†</span></span>
<span class="line"><span>    5         â”œâ”€â”€ conftest.py       # pytest é…ç½®å’Œ fixture å®šä¹‰</span></span>
<span class="line"><span>    6         â”œâ”€â”€ test_api.py       # API æ¥å£æµ‹è¯•</span></span>
<span class="line"><span>    7         â”œâ”€â”€ test_crud.py      # CRUD æ“ä½œæµ‹è¯•</span></span>
<span class="line"><span>    8         â”œâ”€â”€ test_database.py  # æ•°æ®åº“ç›¸å…³æµ‹è¯•</span></span>
<span class="line"><span>    9         â””â”€â”€ test_models.py    # æ•°æ®æ¨¡å‹æµ‹è¯•</span></span></code></pre></div><h3 id="æµ‹è¯•ç”¨ä¾‹å¼€å‘é¡ºåº" tabindex="-1">æµ‹è¯•ç”¨ä¾‹å¼€å‘é¡ºåº <a class="header-anchor" href="#æµ‹è¯•ç”¨ä¾‹å¼€å‘é¡ºåº" aria-label="Permalink to &quot;æµ‹è¯•ç”¨ä¾‹å¼€å‘é¡ºåº&quot;">â€‹</a></h3><p><strong>å¼€å‘é¡ºåº</strong>ï¼ˆè‡ªåº•å‘ä¸Šï¼‰</p><ul><li><code>conftest.py</code> ï¼ˆå·¥è£…å¤¹å…·ï¼‰</li><li><code>test_database.py</code> ï¼ˆéªŒè¯åœ°åŸºï¼‰</li><li><code>test_models.py</code> ï¼ˆéªŒè¯ç –å—ï¼‰</li><li><code>test_crud.py</code> ï¼ˆéªŒè¯ç Œå¢™ï¼‰</li><li><code>test_api.py</code> ï¼ˆéªŒè¯æ•´æ ‹æ¥¼ï¼‰</li></ul><h3 id="æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œ" tabindex="-1">æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œ <a class="header-anchor" href="#æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œ" aria-label="Permalink to &quot;æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œ&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># éªŒè¯æ•°æ®åº“è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pytest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tests/test_database.py</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># éªŒè¯æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pytest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tests/test_models.py</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># éªŒè¯ CRUD æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pytest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tests/test_crud.py</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># éªŒè¯ API æ¥å£</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pytest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tests/test_api.py</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ‰§è¡Œæ‰€æœ‰æµ‹è¯•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pytest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tb=short</span></span></code></pre></div>`,49)])])}const g=i(n,[["render",l]]);export{c as __pageData,g as default};
