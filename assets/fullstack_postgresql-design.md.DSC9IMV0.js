import{_ as i,c as a,o as t,a1 as e}from"./chunks/framework.6sy4tsQT.js";const n="/publish/assets/fullstack/set-up-on-tencent-cloud/create-db-for-user.png",c=JSON.parse('{"title":"PostgreSQL 数据库设计","description":"记录在 PostgreSQL 数据库设计的过程","frontmatter":{"title":"PostgreSQL 数据库设计","description":"记录在 PostgreSQL 数据库设计的过程","date":"2025-12-27T00:00:00.000Z","tags":["PostgreSQL","数据库设计"]},"headers":[],"relativePath":"fullstack/postgresql-design.md","filePath":"fullstack/postgresql-design.md"}'),l={name:"fullstack/postgresql-design.md"};function p(o,s,r,h,d,k){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="测试库和正式库分离" tabindex="-1">测试库和正式库分离 <a class="header-anchor" href="#测试库和正式库分离" aria-label="Permalink to &quot;测试库和正式库分离&quot;">​</a></h2><blockquote><p>2个名字意义明确的数据库，一个用于测试，一个用于正式环境。这是符合工程规范和安全最佳实践的。</p></blockquote><ul><li>将用户命名为 <code>kpfit_test</code> 和 <code>kpfit_prod</code></li></ul><hr><h3 id="这个命名方案的意义" tabindex="-1">这个命名方案的意义 <a class="header-anchor" href="#这个命名方案的意义" aria-label="Permalink to &quot;这个命名方案的意义&quot;">​</a></h3><table tabindex="0"><thead><tr><th>优点</th><th>说明</th></tr></thead><tbody><tr><td><strong>语义清晰</strong></td><td>一看就知道 <code>kpfit_test</code> 是测试用，<code>kpfit_prod</code> 是正式用</td></tr><tr><td><strong>与应用名绑定</strong></td><td>前缀 <code>kpfit</code> 表明这是专属于你应用的数据库账号，避免与其他项目混淆</td></tr><tr><td><strong>环境隔离明确</strong></td><td>开发、测试、部署时不容易连错库（比如不会在 prod 用户下跑测试脚本）</td></tr><tr><td><strong>便于自动化</strong></td><td>CI/CD 脚本、配置文件（如 <code>.env</code>）可以明确区分 <code>DB_USER_TEST</code> vs <code>DB_USER_PROD</code></td></tr></tbody></table><hr><h3 id="配套命名-保持一致性" tabindex="-1">配套命名（保持一致性） <a class="header-anchor" href="#配套命名-保持一致性" aria-label="Permalink to &quot;配套命名（保持一致性）&quot;">​</a></h3><table tabindex="0"><thead><tr><th>对象</th><th>建议名称</th></tr></thead><tbody><tr><td>正式数据库</td><td><code>kpfit_prod_db</code></td></tr><tr><td>测试数据库</td><td><code>kpfit_test_db</code></td></tr><tr><td>正式用户</td><td><code>kpfit_prod</code></td></tr><tr><td>测试用户</td><td><code>kpfit_test</code></td></tr></tbody></table><hr><h3 id="安全与权限" tabindex="-1">安全与权限 <a class="header-anchor" href="#安全与权限" aria-label="Permalink to &quot;安全与权限&quot;">​</a></h3><p>虽然 PostgreSQL 默认已隔离（用户只能操作自己拥有的数据库），但你可以额外加固：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 创建正式用户（强密码）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> USER</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> kpfit_prod</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WITH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PASSWORD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;YourStrong!ProdPassword2025&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> kpfit_prod_db</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OWNER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kpfit_prod;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 创建测试用户（可稍简单，但别用 123456）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> USER</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> kpfit_test</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WITH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PASSWORD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;KpFitTestPass&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> kpfit_test_db</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OWNER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kpfit_test;</span></span></code></pre></div><blockquote><p>⚠️ 切记：<strong>正式库密码不要和测试库相同</strong>，避免凭据泄露导致生产事故。</p></blockquote><hr><h3 id="dbeaver-连接命名" tabindex="-1">DBeaver 连接命名 <a class="header-anchor" href="#dbeaver-连接命名" aria-label="Permalink to &quot;DBeaver 连接命名&quot;">​</a></h3><p>在 DBeaver 中创建两个连接，命名如：</p><ul><li><code>kpfit - PROD</code> → 连 <code>kpfit_prod_db</code> / 用户 <code>kpfit_prod</code></li><li><code>kpfit - TEST</code> → 连 <code>kpfit_test_db</code> / 用户 <code>kpfit_test</code></li></ul><p>这样在左侧导航器中一目了然，大幅降低误操作风险。</p><h2 id="postgres-用户" tabindex="-1">postgres 用户 <a class="header-anchor" href="#postgres-用户" aria-label="Permalink to &quot;postgres 用户&quot;">​</a></h2><blockquote><p>你<strong>不需要“创建 <code>postgres</code> 用户”</strong> —— 因为 <strong><code>postgres</code> 是 PostgreSQL 安装时自动创建的超级用户</strong>，它一定存在，只是你可能还没给它设置密码。</p></blockquote><hr><h3 id="_2个-postgres-用户" tabindex="-1">2个 postgres 用户 <a class="header-anchor" href="#_2个-postgres-用户" aria-label="Permalink to &quot;2个 postgres 用户&quot;">​</a></h3><ul><li>安装 PostgreSQL（无论是 <code>apt install postgresql</code> 还是其他方式）时，系统会<strong>自动创建</strong>： <ul><li>一个<strong>操作系统用户</strong>：<code>postgres</code> - Linux 系统用户（操作系统层面）</li><li>一个<strong>数据库用户（角色）</strong>：<code>postgres</code> - PostgreSQL 数据库角色（数据库内部层面）</li></ul></li></ul><hr><h3 id="操作系统用户postgres" tabindex="-1">操作系统用户<code>postgres</code> <a class="header-anchor" href="#操作系统用户postgres" aria-label="Permalink to &quot;操作系统用户\`postgres\`&quot;">​</a></h3><ul><li>这个 Linux 系统用户 postgres 是个普通用户，它存在的核心意义是 —— 安全隔离（Security Isolation）。</li><li>PostgreSQL 数据库服务必须以一个非 root 的专用系统用户（postgres）运行，这是操作系统安全的基本原则。</li></ul><hr><h4 id="系统用户postgres的作用详解" tabindex="-1">系统用户<code>postgres</code>的作用详解 <a class="header-anchor" href="#系统用户postgres的作用详解" aria-label="Permalink to &quot;系统用户\`postgres\`的作用详解&quot;">​</a></h4><table tabindex="0"><thead><tr><th>作用</th><th>说明</th></tr></thead><tbody><tr><td><strong>1. 服务进程身份</strong></td><td>PostgreSQL 的主进程 (<code>postmaster</code>) 和子进程都以 <code>postgres</code> 用户身份运行</td></tr><tr><td><strong>2. 文件所有权</strong></td><td>所有数据库数据文件（在 <code>/var/lib/postgresql/...</code>）都属于 <code>postgres</code> 用户，其他用户无法读写</td></tr><tr><td><strong>3. 权限最小化</strong></td><td>即使数据库被攻破，攻击者也只能在这个普通用户的权限内活动（不能删系统文件、不能改网络配置等）</td></tr><tr><td><strong>4. 支持 peer 认证</strong></td><td>Linux 用户 <code>deploy</code> 想无密码登录数据库？不行！但 <code>postgres</code> 系统用户可以无密码登录 <code>postgres</code> 数据库角色 —— 这是通过 <strong>peer 认证</strong> 实现的，依赖系统用户身份</td></tr></tbody></table><hr><h4 id="为何不能使用-deploy-来操作" tabindex="-1">为何不能使用 <code>deploy</code> 来操作 <a class="header-anchor" href="#为何不能使用-deploy-来操作" aria-label="Permalink to &quot;为何不能使用 \`deploy\` 来操作&quot;">​</a></h4><p>理论上可以，但<strong>强烈不建议</strong>，原因：</p><ol><li><strong>职责分离原则</strong>：应用用户（<code>deploy</code>）≠ 数据库用户（<code>postgres</code>）</li><li><strong>避免权限污染</strong>：如果 PostgreSQL 用 <code>deploy</code> 运行，一旦数据库崩溃，可能会影响你部署的其他程序</li><li><strong>安全审计困难</strong>：无法区分“是 deploy 用户操作了系统，还是数据库进程操作了系统”</li><li><strong>包管理器依赖</strong>：<code>apt install postgresql</code> 会自动创建 <code>postgres</code> 用户，并硬编码在服务配置中</li></ol><blockquote><p>💡 简单说：<strong>专用服务 → 专用用户</strong>，这是 Linux 世界的黄金法则。</p></blockquote><hr><h3 id="数据库用户-postgres" tabindex="-1">数据库用户 postgres <a class="header-anchor" href="#数据库用户-postgres" aria-label="Permalink to &quot;数据库用户 postgres&quot;">​</a></h3><ul><li>这个 <code>postgres</code> 数据库用户默认是数据库的<strong>超级用户（SUPERUSER）</strong>，拥有数据库的所有权限。</li><li><strong>默认没有设置密码</strong>（因为本地通过 <code>peer</code> 认证，无需密码即可登录）。</li></ul><hr><h4 id="设置-postgres-的密码" tabindex="-1">设置 postgres 的密码 <a class="header-anchor" href="#设置-postgres-的密码" aria-label="Permalink to &quot;设置 postgres 的密码&quot;">​</a></h4><blockquote><p>目标：让 <code>postgres</code> 数据库用户有密码，以便在 DBeaver 中用它执行管理操作（如创建 <code>kpfit_prod</code> 等用户）</p></blockquote><ul><li>步骤（在腾讯云服务器上操作）</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 切换到 postgres 系统用户（无需密码，只要你有 sudo）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deploy@VM-0-13-ubuntu:~$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> postgres</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> psql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[sudo] password </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> deploy:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">psql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (16.11 (Ubuntu </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">16.11-0ubuntu0.24.04.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;help&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> help.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postgres</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">#</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 在 psql 中为 postgres 角色设置密码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 按提示输入一个强密码（比如 YourPostgres!Admin2025）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#    输入时不会显示字符，输完回车即可</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postgres</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">assword postgres</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> password</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;postgres&quot;:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> again:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postgres</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">#</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 退出</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postgres</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\q</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deploy@VM-0-13-ubuntu:~$</span></span></code></pre></div><hr><h4 id="在-dbeaver-中使用" tabindex="-1">在 DBeaver 中使用 <a class="header-anchor" href="#在-dbeaver-中使用" aria-label="Permalink to &quot;在 DBeaver 中使用&quot;">​</a></h4><ul><li><p>你就可以在 DBeaver 中创建一个<strong>管理员连接</strong>：</p></li><li><p>Host: 你的公网 IP</p></li><li><p>Port: 5432</p></li><li><p>Database: <code>postgres</code>（或留空）</p></li><li><p>Username: <code>postgres</code></p></li><li><p>Password: 你刚设置的密码</p></li></ul><p>用这个连接去执行：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> USER</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> kpfit_prod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ...;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> kpfit_prod_db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ...;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 等管理命令</span></span></code></pre></div><hr><h4 id="超级用户不暴露在远程连接中" tabindex="-1">超级用户不暴露在远程连接中 <a class="header-anchor" href="#超级用户不暴露在远程连接中" aria-label="Permalink to &quot;超级用户不暴露在远程连接中&quot;">​</a></h4><p>你<strong>完全可以在服务器上用 <code>sudo -u postgres psql</code> 直接执行所有管理命令</strong>（就像你之前做的那样），<strong>不需要 DBeaver 连 <code>postgres</code></strong>。</p><p>也就是说：</p><ul><li><strong>日常开发</strong>：用 <code>kpfit_test</code> / <code>kpfit_prod</code> 连接</li><li><strong>数据库管理（建用户/库）</strong>：直接在服务器终端用 <code>sudo -u postgres psql</code> 操作</li></ul><blockquote><p>✅ 这其实是<strong>更安全的做法</strong> —— 超级用户不暴露在远程连接中。</p></blockquote><hr><h2 id="创建数据库" tabindex="-1">创建数据库 <a class="header-anchor" href="#创建数据库" aria-label="Permalink to &quot;创建数据库&quot;">​</a></h2><h3 id="postgres-用户连接数据库报错" tabindex="-1">postgres 用户连接数据库报错 <a class="header-anchor" href="#postgres-用户连接数据库报错" aria-label="Permalink to &quot;postgres 用户连接数据库报错&quot;">​</a></h3><ul><li>DBeaver 中用 <code>postgres</code> 用户连接数据库时，连接数据库时的报错：</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FATAL:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pg_hba.conf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> entry</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;124.79.8.217&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;postgres&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> database</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;postgres&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SSL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> encryption</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这个错误非常典型，说明 PostgreSQL 拒绝了你从本地 IP 124.79.8.217 的连接请求.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 因为 pg_hba.conf 中没有允许该 IP 用 postgres 用户访问。</span></span></code></pre></div><hr><h3 id="解决-postgres-无法远程连接" tabindex="-1">解决 postgres 无法远程连接 <a class="header-anchor" href="#解决-postgres-无法远程连接" aria-label="Permalink to &quot;解决 postgres 无法远程连接&quot;">​</a></h3><h4 id="第-1-步-确认你的本地公网-ip" tabindex="-1">第 1 步：确认你的本地公网 IP <a class="header-anchor" href="#第-1-步-确认你的本地公网-ip" aria-label="Permalink to &quot;第 1 步：确认你的本地公网 IP&quot;">​</a></h4><p>你已经知道是 <code>124.79.8.217</code>（从错误信息中看出），但建议再次确认：</p><ul><li>在本地电脑访问 <a href="https://ip.cn" target="_blank" rel="noreferrer">https://ip.cn</a> 或 <a href="https://whatismyipaddress.com" target="_blank" rel="noreferrer">https://whatismyipaddress.com</a></li><li>确保 IP 没变（家庭宽带 IP 可能会变）</li></ul><h4 id="第-2-步-编辑服务器上的-pg-hba-conf" tabindex="-1">第 2 步：编辑服务器上的 <code>pg_hba.conf</code> <a class="header-anchor" href="#第-2-步-编辑服务器上的-pg-hba-conf" aria-label="Permalink to &quot;第 2 步：编辑服务器上的 \`pg_hba.conf\`&quot;">​</a></h4><p>登录腾讯云服务器，执行：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/postgresql/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/main/pg_hba.conf</span></span></code></pre></div><p>在文件<strong>末尾</strong>添加一行（允许你的 IP 用密码登录 <code>postgres</code> 用户）：</p><div class="language-conf vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">conf</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 允许特定 IP 使用 postgres 用户远程登录（仅用于管理！）</span></span>
<span class="line"><span>host    postgres    postgres    124.79.8.217/32    md5</span></span></code></pre></div><blockquote><p>🔒 <strong>安全提醒</strong>：</p><ul><li><strong>不要用 <code>0.0.0.0/0</code></strong>，除非临时测试（测试完立刻改回）</li><li><code>md5</code> 表示使用密码认证（你已为 <code>postgres</code> 设置密码）</li></ul></blockquote><hr><h4 id="第-3-步-确保-postgresql-conf-允许远程连接" tabindex="-1">第 3 步：确保 <code>postgresql.conf</code> 允许远程连接 <a class="header-anchor" href="#第-3-步-确保-postgresql-conf-允许远程连接" aria-label="Permalink to &quot;第 3 步：确保 \`postgresql.conf\` 允许远程连接&quot;">​</a></h4><p>检查：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/postgresql/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/main/postgresql.conf</span></span></code></pre></div><p>确保有：</p><div class="language-conf vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">conf</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>listen_addresses = &#39;*&#39;</span></span></code></pre></div><hr><h4 id="第-4-步-重启-postgresql-服务" tabindex="-1">第 4 步：重启 PostgreSQL 服务 <a class="header-anchor" href="#第-4-步-重启-postgresql-服务" aria-label="Permalink to &quot;第 4 步：重启 PostgreSQL 服务&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> postgresql</span></span></code></pre></div><hr><h4 id="第-5-步-dbeaver-连接配置" tabindex="-1">第 5 步：DBeaver 连接配置 <a class="header-anchor" href="#第-5-步-dbeaver-连接配置" aria-label="Permalink to &quot;第 5 步：DBeaver 连接配置&quot;">​</a></h4><p>在 DBeaver 中，你的连接应设置为：</p><table tabindex="0"><thead><tr><th>字段</th><th>值</th></tr></thead><tbody><tr><td>Host</td><td>腾讯云服务器公网 IP</td></tr><tr><td>Port</td><td>5432</td></tr><tr><td>Database</td><td><code>postgres</code></td></tr><tr><td>Username</td><td><code>postgres</code></td></tr><tr><td>Password</td><td>你设置的 <code>postgres</code> 密码</td></tr><tr><td>SSL</td><td><strong>建议设为 <code>disable</code> 临时测试</strong>（或选 <code>allow</code>）</td></tr></tbody></table><blockquote><p>💡 关于 SSL：<br> 错误信息中提到 <code>SSL encryption</code>，说明 DBeaver 默认尝试 SSL 连接，但你的 PG 可能未配置 SSL。<br><strong>临时解决</strong>：在 DBeaver 连接设置 → <strong>「SSL」标签页 → 勾选 “Disable SSL”</strong><br> （生产环境建议配 SSL，但现在先通再说）</p></blockquote><hr><h4 id="安全建议-重要" tabindex="-1">安全建议（重要！） <a class="header-anchor" href="#安全建议-重要" aria-label="Permalink to &quot;安全建议（重要！）&quot;">​</a></h4><ul><li><strong><code>postgres</code> 超级用户不要长期开放远程访问！</strong></li><li>建议： <ol><li>用 <code>postgres</code> 连接创建好 <code>kpfit_prod</code> / <code>kpfit_test</code> 用户和库</li><li><strong>立即从 <code>pg_hba.conf</code> 中删除 <code>postgres</code> 的远程规则</strong></li><li>日常只用 <code>kpfit_*</code> 用户连接</li></ol></li><li>或者至少：<strong>只允许你的固定 IP 访问</strong></li></ul><hr><h3 id="替代方案-更安全-不用远程连-postgres" tabindex="-1">替代方案（更安全）：不用远程连 <code>postgres</code> <a class="header-anchor" href="#替代方案-更安全-不用远程连-postgres" aria-label="Permalink to &quot;替代方案（更安全）：不用远程连 \`postgres\`&quot;">​</a></h3><p>你其实<strong>不需要在 DBeaver 中连 <code>postgres</code></strong>！<br> 所有管理操作都可以在服务器上用 <code>sudo -u postgres psql</code> 完成：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建用户和库（在服务器执行）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> postgres</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> psql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CREATE USER kpfit_prod WITH PASSWORD &#39;xxx&#39;;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CREATE DATABASE kpfit_prod_db OWNER kpfit_prod;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span></code></pre></div><p>这样就<strong>完全不需要开放 <code>postgres</code> 远程权限</strong>，更安全！</p><hr><p><img src="`+n+'" alt="DBeaver 下创建数据库"></p>',94)])])}const F=i(l,[["render",p]]);export{c as __pageData,F as default};
